<!DOCTYPE html>
<html lang='en' class=''>

<head>

  <meta charset='UTF-8'>
  <title>Callback Page - Parameter View</title>
  <meta name="robots" content="noindex">

  <link rel="shortcut icon" type="image/png" href="icon.png">

<link rel="stylesheet" href="style.css">
</head>

  <body>

      <h1 style="color:rgb(41, 0, 87);">
        Callback Parameters
      </h1>
    
      <p id="rq"></p>
      <p id="status"></p>
      <p id="t"></p>
      <p id="errorMsg"></p>
      

  <script>
    function GetURLParameter(sParam){
      var sPageURL = window.location.search.substring(1);
      var sURLVariables = sPageURL.split('&');
      for (var i = 0; i < sURLVariables.length; i++) 
      {
          var sParameterName = sURLVariables[i].split('=');
          if (sParameterName[0] == sParam) 
          {
              return sParameterName[1];
          }
      } 
    } 

    let rq = GetURLParameter('request-id');
    let status = GetURLParameter('transfer-status');
    let t = GetURLParameter('transfer-id');
    let errorMsg = GetURLParameter('message');


    rq = decodeURIComponent(rq);
    t = decodeURIComponent(t);
    errorMsg = decodeURIComponent(errorMsg);

    document.getElementById("rq").innerHTML = "requestId : " + rq;
    document.getElementById("status").innerHTML = "Payment Initiation Status : " + status;
    document.getElementById("t").innerHTML = "transferId : " + t;
    document.getElementById("errorMsg").innerHTML = "Error Message : " + errorMsg;

  </script>

  <script>

    function renderrq(data) {
    // Get text elements
  
      document.getElementById("rq").innerHTML = "requestId : " + rq;
      document.getElementById("status").innerHTML = "First Payment Initiation Status : " + status;
      document.getElementById("t").innerHTML = "transferId : " + t;
      document.getElementById("errorMsg").innerHTML = "Error Message : " + errorMsg;

      trStatus.innerHTML = "Token Request Status : " + data.status;
      console.log(data.status);

    } 

    function refreshTR() {
      fetch("https://api.token.io/token-requests/"+rq+"/result", {
        method: "GET",
        headers: {
            "Authorization" : "Basic bS0yckV0aTV4ZlhQWDEzRjdmc1NwZ1U5RmRYN3dzLTV6S3RYRUFxOjlhODU0ZmJhLTAyMTYtNDg5Zi04ZWJlLWY5OTBlNjMyNTM3Yg==",
            "Content-Type": "application/json",
        }
      })
      .then((response) => response.json())
      .then((data) => renderrq(data));
    }


    function rendert(data) {
    // Get text elements
  

      tStatus.innerHTML = "Polled Payment Initiation Status : " + data.transfer.status;
      console.log(data.transfer.status);
    } 
    function refreshT() {
      fetch("https://api.token.io/transfers/"+t, {
        method: "GET",
        headers: {
            "Authorization" : "Basic bS0yckV0aTV4ZlhQWDEzRjdmc1NwZ1U5RmRYN3dzLTV6S3RYRUFxOjlhODU0ZmJhLTAyMTYtNDg5Zi04ZWJlLWY5OTBlNjMyNTM3Yg==",
            "Content-Type": "application/json",
        }
      })
      .then((response) => response.json())
      .then((data) => rendert(data));
    }



  </script>
  <p></p>

  <button id="button" onclick="refreshTR()" type='paymentbutton' >Refresh Token Request status</button>

  <p id="trStatus"></p>
  <p></p>
  <button id="button" onclick="refreshT()" type='paymentbutton' >Refresh Payment Initiation status</button>
  <p id="tStatus"></p>

  </body>
</html> 